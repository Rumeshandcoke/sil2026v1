<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
    <title>Sohum Hearing Screener</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
      tailwind.config = {
        theme: {
          extend: {
            colors: {
              primary: '#202B5D',
              secondary: '#F3F4F6',
            },
            fontFamily: {
              sans: ['Inter', 'system-ui', 'sans-serif'],
            }
          }
        }
      }
    </script>
    <style>
      body {
        margin: 0;
        background-color: #f9fafb;
        display: flex;
        justify-content: center;
        min-height: 100vh;
      }
      #root {
        width: 100%;
        max-width: 480px;
        background-color: white;
        min-height: 100vh;
        box-shadow: 0 0 20px rgba(0,0,0,0.05);
        position: relative;
        overflow-x: hidden;
      }
      ::-webkit-scrollbar { width: 0px; background: transparent; }
    </style>
    <script type="importmap">
    {
      "imports": {
        "react-dom/": "https://esm.sh/react-dom@^19.0.0/",
        "react/": "https://esm.sh/react@^19.0.0/",
        "react": "https://esm.sh/react@^19.0.0"
      }
    }
    </script>
  </head>
  <body>
    <div id="root"></div>
    <script type="module">
import React, { useState } from 'react';
import { createRoot } from 'react-dom/client';

// ─── GOOGLE SHEETS URL (HARDCODED) ──────────────────────────────
const SCRIPT_URL = 'https://script.google.com/macros/s/AKfycbwpBck6Dsu2X_1lf4Dm7052zy0NK09DXebc4UdJoTp29Ht8jbJ4Gl5GZrcPfB-Dnx7q/exec';

// ─── SHARED COMPONENTS ───────────────────────────────────────────

const Header = ({ title, subtitle, onBack }) => (
  React.createElement('div', { className: "bg-primary text-white pt-12 pb-6 px-6 rounded-b-[2rem] shadow-md relative" },
    onBack && React.createElement('button', { onClick: onBack, className: "absolute left-6 top-14 text-white/80 hover:text-white transition-colors" },
      React.createElement('svg', { xmlns: "http://www.w3.org/2000/svg", width: "24", height: "24", viewBox: "0 0 24 24", fill: "none", stroke: "currentColor", strokeWidth: "2", strokeLinecap: "round", strokeLinejoin: "round" },
        React.createElement('path', { d: "m15 18-6-6 6-6" })
      )
    ),
    React.createElement('h1', { className: `text-2xl font-semibold tracking-wide ${onBack ? 'text-center' : ''}` }, title),
    subtitle && React.createElement('p', { className: `text-blue-200 text-sm mt-1 ${onBack ? 'text-center' : ''}` }, subtitle)
  )
);

const Container = ({ children, className = '' }) =>
  React.createElement('div', { className: `p-6 flex flex-col gap-5 ${className}` }, children);

const Card = ({ children, className = '', onClick }) =>
  React.createElement('div', {
    onClick,
    className: `bg-white rounded-2xl shadow-sm border border-gray-100 p-5 ${onClick ? 'cursor-pointer hover:shadow-md transition-shadow active:scale-[0.99]' : ''} ${className}`
  }, children);

const Input = ({ label, error, className = '', ...props }) =>
  React.createElement('div', { className: "flex flex-col gap-1.5 w-full" },
    label && React.createElement('label', { className: "text-sm font-medium text-gray-700 ml-1" }, label),
    React.createElement('input', {
      className: `bg-secondary border-none rounded-xl px-4 py-3.5 text-gray-800 placeholder:text-gray-400 focus:outline-none focus:ring-2 focus:ring-primary/20 transition-all ${error ? 'ring-2 ring-red-400' : ''} ${className}`,
      ...props
    }),
    error && React.createElement('span', { className: "text-xs text-red-500 ml-1" }, error)
  );

const Select = ({ label, error, children, ...props }) =>
  React.createElement('div', { className: "flex flex-col gap-1.5 w-full" },
    label && React.createElement('label', { className: "text-sm font-medium text-gray-700 ml-1" }, label),
    React.createElement('select', {
      className: `bg-secondary border-none rounded-xl px-4 py-3.5 text-gray-800 focus:outline-none focus:ring-2 focus:ring-primary/20 appearance-none ${error ? 'ring-2 ring-red-400' : ''}`,
      ...props
    }, children),
    error && React.createElement('span', { className: "text-xs text-red-500 ml-1" }, error)
  );

const RadioGroup = ({ label, options, value, onChange }) =>
  React.createElement('div', { className: "flex flex-col gap-2" },
    React.createElement('label', { className: "text-sm font-medium text-gray-700 ml-1" }, label),
    React.createElement('div', { className: "flex flex-wrap gap-2" },
      options.map(opt =>
        React.createElement('button', {
          key: opt.value,
          type: "button",
          onClick: () => onChange(opt.value),
          className: `flex-1 py-3 px-4 rounded-xl text-sm font-medium transition-colors border ${
            value === opt.value
              ? 'bg-primary border-primary text-white shadow-md'
              : 'bg-white border-gray-200 text-gray-600 hover:bg-gray-50'
          }`
        }, opt.label)
      )
    )
  );

const Button = ({ children, isLoading, className = '', disabled, ...props }) =>
  React.createElement('button', {
    disabled: disabled || isLoading,
    className: `w-full rounded-xl py-4 font-semibold text-center transition-all flex justify-center items-center gap-2 bg-primary text-white hover:bg-blue-900 active:bg-blue-950 shadow-md ${(disabled || isLoading) ? 'opacity-70 cursor-not-allowed' : ''} ${className}`,
    ...props
  },
    isLoading
      ? React.createElement('svg', { className: "animate-spin h-5 w-5 text-current", xmlns: "http://www.w3.org/2000/svg", fill: "none", viewBox: "0 0 24 24" },
          React.createElement('circle', { className: "opacity-25", cx: "12", cy: "12", r: "10", stroke: "currentColor", strokeWidth: "4" }),
          React.createElement('path', { className: "opacity-75", fill: "currentColor", d: "M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z" })
        )
      : children
  );

const StickyBottom = ({ children }) =>
  React.createElement('div', { className: "fixed bottom-0 left-0 right-0 bg-white border-t border-gray-100 p-4 pb-6 mx-auto max-w-[480px]" }, children);

// ─── SCREEN 1: LOGIN ─────────────────────────────────────────────

const LoginScreen = ({ onSuccess }) => {
  const [userId, setUserId] = useState('');
  const [password, setPassword] = useState('');
  const [error, setError] = useState('');

  const handle = () => {
    if (!userId || !password) { setError('Please enter both User ID and Password'); return; }
    const name = userId === 'admin' ? 'Arpita Jain' : `Dr. ${userId}`;
    onSuccess(name, userId);
  };

  return React.createElement('div', { className: "flex flex-col min-h-screen bg-white" },
    React.createElement('div', { className: "flex-1 flex flex-col items-center justify-center p-8 text-center mt-[-10vh]" },
      React.createElement('div', { className: "w-24 h-24 bg-primary text-white rounded-3xl flex items-center justify-center text-4xl font-bold mb-8 shadow-lg shadow-blue-900/20" }, "S"),
      React.createElement('h1', { className: "text-3xl font-bold text-gray-900 mb-2" }, "Sohum"),
      React.createElement('p', { className: "text-gray-500 mb-10" }, "Hearing Screening System"),
      React.createElement('div', { className: "w-full flex flex-col gap-4" },
        React.createElement(Input, { placeholder: "User ID", value: userId, onChange: e => { setUserId(e.target.value); setError(''); } }),
        React.createElement(Input, { type: "password", placeholder: "Password", value: password, onChange: e => { setPassword(e.target.value); setError(''); } }),
        error && React.createElement('p', { className: "text-red-500 text-sm" }, error)
      )
    ),
    React.createElement('div', { className: "p-6" }, React.createElement(Button, { onClick: handle }, "Sign In"))
  );
};

// ─── SCREEN 2: SESSION SETUP ──────────────────────────────────────

const SessionSetupScreen = ({ initialData, onComplete }) => {
  const [hospital, setHospital] = useState(initialData.hospitalName || '');
  const [date, setDate] = useState(initialData.sessionDate || new Date().toISOString().split('T')[0]);
  const [error, setError] = useState('');

  const handle = () => {
    if (!hospital || !date) { setError('All fields are mandatory.'); return; }
    onComplete({ hospitalName: hospital, sessionDate: date });
  };

  return React.createElement('div', { className: "flex flex-col min-h-screen pb-24" },
    React.createElement(Header, { title: "Session Setup", subtitle: `Welcome, ${initialData.hwName}` }),
    React.createElement(Container, { className: "flex-1" },
      React.createElement('p', { className: "text-sm text-gray-500 px-1" }, "Select your hospital and confirm the date."),
      React.createElement(Select, { label: "Hospital *", value: hospital, onChange: e => { setHospital(e.target.value); setError(''); } },
        React.createElement('option', { value: "", disabled: true }, "Select hospital..."),
        React.createElement('option', { value: "Manipal BLR" }, "Manipal BLR"),
        React.createElement('option', { value: "Fortis BLR" }, "Fortis BLR"),
        React.createElement('option', { value: "Apollo BLR" }, "Apollo BLR"),
        React.createElement('option', { value: "Cloudnine BLR" }, "Cloudnine BLR")
      ),
      React.createElement(Input, { type: "date", label: "Date *", value: date, onChange: e => { setDate(e.target.value); setError(''); } }),
      error && React.createElement('p', { className: "text-red-500 text-sm" }, error)
    ),
    React.createElement(StickyBottom, null, React.createElement(Button, { onClick: handle }, "Start Session"))
  );
};

// ─── SCREEN 3: MAIN MENU ──────────────────────────────────────────

const MainMenuScreen = ({ record, onNewBaby }) =>
  React.createElement('div', { className: "flex flex-col min-h-screen bg-gray-50" },
    React.createElement('div', { className: "bg-primary pt-12 pb-24 px-6 rounded-b-[2.5rem] shadow-md" },
      React.createElement('div', { className: "flex justify-between items-center text-white mb-6" },
        React.createElement('div', null,
          React.createElement('h1', { className: "text-2xl font-bold" }, "Home"),
          React.createElement('p', { className: "text-blue-200 text-sm opacity-90" }, record.hospitalName)
        ),
        React.createElement('div', { className: "w-10 h-10 bg-white/20 rounded-full flex items-center justify-center" },
          React.createElement('svg', { xmlns: "http://www.w3.org/2000/svg", width: "20", height: "20", viewBox: "0 0 24 24", fill: "none", stroke: "currentColor", strokeWidth: "2", strokeLinecap: "round", strokeLinejoin: "round" },
            React.createElement('path', { d: "M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2" }),
            React.createElement('circle', { cx: "12", cy: "7", r: "4" })
          )
        )
      ),
      React.createElement('div', { className: "inline-flex items-center gap-2 bg-white/10 px-3 py-1.5 rounded-full text-xs text-white/90" },
        React.createElement('span', { className: "w-2 h-2 rounded-full bg-green-400" }),
        "Session Active"
      )
    ),
    React.createElement(Container, { className: "mt-[-4rem]" },
      React.createElement(Card, { onClick: onNewBaby, className: "flex flex-col items-center justify-center p-8 gap-4 shadow-lg border-none hover:-translate-y-1 transition-transform" },
        React.createElement('div', { className: "w-16 h-16 bg-blue-100 text-primary rounded-2xl flex items-center justify-center" },
          React.createElement('svg', { xmlns: "http://www.w3.org/2000/svg", width: "32", height: "32", viewBox: "0 0 24 24", fill: "none", stroke: "currentColor", strokeWidth: "2", strokeLinecap: "round", strokeLinejoin: "round" },
            React.createElement('path', { d: "M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2" }),
            React.createElement('circle', { cx: "9", cy: "7", r: "4" }),
            React.createElement('line', { x1: "19", x2: "19", y1: "8", y2: "14" }),
            React.createElement('line', { x1: "22", x2: "16", y1: "11", y2: "11" })
          )
        ),
        React.createElement('div', { className: "text-center" },
          React.createElement('h2', { className: "text-lg font-bold text-gray-800" }, "Register New Baby"),
          React.createElement('p', { className: "text-sm text-gray-500 mt-1" }, "Start a new screening process")
        )
      )
    )
  );

// ─── SCREEN 4: BABY REGISTRATION ─────────────────────────────────

const BabyRegistrationScreen = ({ onBack, onNext }) => {
  const [form, setForm] = useState({ babyName: '', dateOfBirth: '', gender: '', gestationalAge: '', parentName: '', parentPhone: '' });
  const [riskFactors, setRiskFactors] = useState([]);
  const [error, setError] = useState('');

  const riskOptions = [
    "NICU > 5 days",
    "Family history of hearing loss",
    "Craniofacial anomalies",
    "In utero infections",
    "Hyperbilirubinemia",
    "Syndromes associated with hearing loss"
  ];

  const toggleRisk = r => setRiskFactors(prev => prev.includes(r) ? prev.filter(x => x !== r) : [...prev, r]);

  const handle = () => {
    if (!form.babyName || !form.dateOfBirth || !form.gender || !form.gestationalAge || !form.parentName || !form.parentPhone) {
      setError('Please fill out all required fields.'); return;
    }
    const id = Math.floor(1000 + Math.random() * 9000);
    onNext({ ...form, riskFactors, screeningId: `SCR-${new Date().getFullYear()}-${id}`, babyId: `BBY-${id}` });
  };

  return React.createElement('div', { className: "flex flex-col min-h-screen pb-24" },
    React.createElement(Header, { title: "Patient Information", onBack }),
    React.createElement(Container, null,
      React.createElement(Input, { label: "Baby's Name *", value: form.babyName, onChange: e => setForm({...form, babyName: e.target.value}) }),
      React.createElement('div', { className: "flex gap-4 items-end" },
        React.createElement(Input, { type: "date", label: "Date of Birth *", value: form.dateOfBirth, onChange: e => setForm({...form, dateOfBirth: e.target.value}) }),
        React.createElement('div', { className: "w-1/2" },
          React.createElement(RadioGroup, { label: "Gender *", value: form.gender, onChange: v => setForm({...form, gender: v}), options: [{label:'M',value:'Male'},{label:'F',value:'Female'},{label:'O',value:'Other'}] })
        )
      ),
      React.createElement(Input, { label: "Gestational Age (weeks) *", type: "number", placeholder: "e.g. 38", value: form.gestationalAge, onChange: e => setForm({...form, gestationalAge: e.target.value}) }),

      React.createElement('div', { className: "flex flex-col gap-2" },
        React.createElement('label', { className: "text-sm font-medium text-gray-700 ml-1" }, "Risk Factors"),
        React.createElement('div', { className: "bg-secondary rounded-xl p-4 flex flex-col gap-3" },
          riskOptions.map(r =>
            React.createElement('label', { key: r, className: "flex items-start gap-3 cursor-pointer" },
              React.createElement('input', { type: "checkbox", className: "mt-1 w-4 h-4 text-primary bg-white border-gray-300 rounded focus:ring-primary", checked: riskFactors.includes(r), onChange: () => toggleRisk(r) }),
              React.createElement('span', { className: "text-sm text-gray-700 leading-snug" }, r)
            )
          ),
          riskFactors.length === 0 && React.createElement('p', { className: "text-xs text-gray-400 italic ml-7" }, "No risk factors selected")
        )
      ),

      React.createElement('div', { className: "h-px bg-gray-200" }),
      React.createElement(Input, { label: "Parent / Guardian Name *", value: form.parentName, onChange: e => setForm({...form, parentName: e.target.value}) }),
      React.createElement(Input, { label: "Phone Number *", type: "tel", value: form.parentPhone, onChange: e => setForm({...form, parentPhone: e.target.value}) }),
      error && React.createElement('p', { className: "text-red-500 text-sm" }, error)
    ),
    React.createElement(StickyBottom, null, React.createElement(Button, { onClick: handle }, "Continue to Test Selection"))
  );
};

// ─── SCREEN 5: TEST SELECTION ─────────────────────────────────────

const TestSelectionScreen = ({ onBack, onSelect }) =>
  React.createElement('div', { className: "flex flex-col min-h-screen bg-gray-50" },
    React.createElement(Header, { title: "Select Test Type", onBack }),
    React.createElement(Container, { className: "flex-1 justify-center gap-6 pb-20" },
      React.createElement(Card, { onClick: () => onSelect('AABR'), className: "flex flex-col items-center justify-center p-10 py-16 gap-4 border-2 border-transparent hover:border-primary/20" },
        React.createElement('h2', { className: "text-2xl font-bold text-primary tracking-wider" }, "AABR"),
        React.createElement('p', { className: "text-sm text-gray-500 text-center" }, "Automated Auditory Brainstem Response")
      ),
      React.createElement(Card, { onClick: () => onSelect('OAE'), className: "flex flex-col items-center justify-center p-10 py-16 gap-4 border-2 border-transparent hover:border-primary/20" },
        React.createElement('h2', { className: "text-2xl font-bold text-primary tracking-wider" }, "OAE"),
        React.createElement('p', { className: "text-sm text-gray-500 text-center" }, "Otoacoustic Emissions")
      )
    )
  );

// ─── SCREEN 6: AABR ENTRY ─────────────────────────────────────────

const AABREntryScreen = ({ onBack, onNext }) => {
  const [data, setData] = useState({ testEar: '', impedanceValue: '', snrValue: '', result35dB: '', result50dB: '', result70dB: '', result90dB: '' });
  const [error, setError] = useState('');

  const resultOpts = [{label:'PASS',value:'PASS'},{label:'REFER',value:'REFER'},{label:'REDO',value:'REDO'}];

  const handle = () => {
    if (!data.testEar || !data.impedanceValue || !data.snrValue || !data.result35dB || !data.result50dB || !data.result70dB || !data.result90dB) {
      setError('All fields and results are required.'); return;
    }
    onNext(data);
  };

  return React.createElement('div', { className: "flex flex-col min-h-screen pb-24" },
    React.createElement(Header, { title: "AABR Entry", subtitle: "Manual Result Entry", onBack }),
    React.createElement(Container, { className: "gap-6" },
      React.createElement(RadioGroup, { label: "Test Ear *", value: data.testEar, onChange: v => setData({...data, testEar: v}), options: [{label:'Left',value:'Left'},{label:'Right',value:'Right'},{label:'Both',value:'Both'}] }),
      React.createElement('div', { className: "flex gap-4" },
        React.createElement(Input, { label: "Impedance (kΩ) *", placeholder: "kΩ", value: data.impedanceValue, onChange: e => setData({...data, impedanceValue: e.target.value}) }),
        React.createElement(Input, { label: "SNR (dB) *", placeholder: "dB", value: data.snrValue, onChange: e => setData({...data, snrValue: e.target.value}) })
      ),
      React.createElement('div', { className: "bg-gray-50 rounded-2xl p-5 border border-gray-100 flex flex-col gap-5" },
        React.createElement('h3', { className: "text-sm font-semibold text-gray-700 uppercase tracking-wider" }, "Results Grid"),
        React.createElement(RadioGroup, { label: "35 dB", value: data.result35dB, onChange: v => setData({...data, result35dB: v}), options: resultOpts }),
        React.createElement(RadioGroup, { label: "50 dB", value: data.result50dB, onChange: v => setData({...data, result50dB: v}), options: resultOpts }),
        React.createElement(RadioGroup, { label: "70 dB", value: data.result70dB, onChange: v => setData({...data, result70dB: v}), options: resultOpts }),
        React.createElement(RadioGroup, { label: "90 dB", value: data.result90dB, onChange: v => setData({...data, result90dB: v}), options: resultOpts })
      ),
      error && React.createElement('p', { className: "text-red-500 text-sm" }, error)
    ),
    React.createElement(StickyBottom, null, React.createElement(Button, { onClick: handle }, "Proceed to Recommendation"))
  );
};

// ─── SCREEN 7: OAE ENTRY ──────────────────────────────────────────

const OAEEntryScreen = ({ onBack, onNext }) => {
  const [data, setData] = useState({ testEar: '', oae1Result: '', oae2Result: '' });
  const [error, setError] = useState('');

  const resultOpts = [{label:'PASS',value:'PASS'},{label:'REFER',value:'REFER'}];

  const handle = () => {
    if (!data.testEar || !data.oae1Result || !data.oae2Result) { setError('All fields are required.'); return; }
    onNext(data);
  };

  return React.createElement('div', { className: "flex flex-col min-h-screen pb-24" },
    React.createElement(Header, { title: "OAE Entry", subtitle: "Manual Result Entry", onBack }),
    React.createElement(Container, { className: "gap-6" },
      React.createElement(RadioGroup, { label: "Test Ear *", value: data.testEar, onChange: v => setData({...data, testEar: v}), options: [{label:'Left',value:'Left'},{label:'Right',value:'Right'},{label:'Both',value:'Both'}] }),
      React.createElement('div', { className: "bg-gray-50 rounded-2xl p-5 border border-gray-100 flex flex-col gap-6" },
        React.createElement('h3', { className: "text-sm font-semibold text-gray-700 uppercase tracking-wider" }, "Results"),
        React.createElement(RadioGroup, { label: "OAE Test 1 *", value: data.oae1Result, onChange: v => setData({...data, oae1Result: v}), options: resultOpts }),
        React.createElement('div', { className: "h-px bg-gray-200" }),
        React.createElement(RadioGroup, { label: "OAE Test 2 *", value: data.oae2Result, onChange: v => setData({...data, oae2Result: v}), options: resultOpts })
      ),
      error && React.createElement('p', { className: "text-red-500 text-sm" }, error)
    ),
    React.createElement(StickyBottom, null, React.createElement(Button, { onClick: handle }, "Proceed to Recommendation"))
  );
};

// ─── SCREEN 8: RECOMMENDATION ────────────────────────────────────

const RecommendationScreen = ({ onBack, onSave }) => {
  const [rec, setRec] = useState('');
  const [error, setError] = useState('');

  const handle = () => {
    if (!rec) { setError('Please select a recommendation.'); return; }
    onSave(rec);
  };

  return React.createElement('div', { className: "flex flex-col min-h-screen pb-24" },
    React.createElement(Header, { title: "Recommendation", onBack }),
    React.createElement(Container, { className: "flex-1 mt-2" },
      React.createElement(Select, { label: "Final Action / Recommendation *", value: rec, onChange: e => { setRec(e.target.value); setError(''); } },
        React.createElement('option', { value: "", disabled: true }, "Select an action..."),
        React.createElement('option', { value: "No Action Required" }, "No Action Required"),
        React.createElement('option', { value: "Repeat Screening" }, "Repeat Screening"),
        React.createElement('option', { value: "Refer for Diagnostic BERA" }, "Refer for Diagnostic BERA"),
        React.createElement('option', { value: "Follow Up Required" }, "Follow Up Required")
      ),
      React.createElement(Card, { className: "bg-blue-50 border-blue-100" },
        React.createElement('div', { className: "flex gap-3 items-start" },
          React.createElement('svg', { className: "text-blue-500 shrink-0 mt-0.5", xmlns: "http://www.w3.org/2000/svg", width: "20", height: "20", viewBox: "0 0 24 24", fill: "none", stroke: "currentColor", strokeWidth: "2", strokeLinecap: "round", strokeLinejoin: "round" },
            React.createElement('circle', { cx: "12", cy: "12", r: "10" }),
            React.createElement('path', { d: "M12 16v-4" }),
            React.createElement('path', { d: "M12 8h.01" })
          ),
          React.createElement('p', { className: "text-sm text-blue-900 leading-relaxed" }, "Clicking save will compile the complete Screening Record and push the data to Google Sheets. Ensure all information is accurate.")
        )
      ),
      error && React.createElement('p', { className: "text-red-500 text-sm" }, error)
    ),
    React.createElement(StickyBottom, null, React.createElement(Button, { onClick: handle }, "Save Record"))
  );
};

// ─── SCREEN 9: SYNCING ───────────────────────────────────────────

const SyncingScreen = () =>
  React.createElement('div', { className: "flex flex-col min-h-screen bg-white items-center justify-center p-8 text-center gap-6" },
    React.createElement('svg', { className: "animate-spin h-12 w-12 text-primary", xmlns: "http://www.w3.org/2000/svg", fill: "none", viewBox: "0 0 24 24" },
      React.createElement('circle', { className: "opacity-25", cx: "12", cy: "12", r: "10", stroke: "currentColor", strokeWidth: "4" }),
      React.createElement('path', { className: "opacity-75", fill: "currentColor", d: "M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z" })
    ),
    React.createElement('div', null,
      React.createElement('h2', { className: "text-xl font-semibold text-gray-800" }, "Saving Record..."),
      React.createElement('p', { className: "text-gray-500 mt-2 text-sm" }, "Pushing data securely to Google Sheets.")
    )
  );

// ─── SCREEN 10: SUCCESS ──────────────────────────────────────────

const SuccessScreen = ({ record, onReturn }) =>
  React.createElement('div', { className: "flex flex-col min-h-screen bg-gray-50" },
    React.createElement(Header, { title: "Success" }),
    React.createElement(Container, { className: "flex-1 items-center justify-center -mt-10" },
      React.createElement(Card, { className: "flex flex-col items-center justify-center p-8 w-full text-center gap-4" },
        React.createElement('div', { className: "w-16 h-16 bg-green-100 text-green-500 rounded-full flex items-center justify-center mb-2" },
          React.createElement('svg', { xmlns: "http://www.w3.org/2000/svg", width: "32", height: "32", viewBox: "0 0 24 24", fill: "none", stroke: "currentColor", strokeWidth: "3", strokeLinecap: "round", strokeLinejoin: "round" },
            React.createElement('polyline', { points: "20 6 9 17 4 12" })
          )
        ),
        React.createElement('h2', { className: "text-2xl font-bold text-gray-800" }, "Record Saved"),
        React.createElement('p', { className: "text-sm text-gray-500" },
          "Screening ID ", React.createElement('span', { className: "font-mono bg-gray-100 px-1 rounded" }, record.screeningId), " has been successfully logged."
        ),
        React.createElement(Button, { className: "mt-6", onClick: onReturn }, "Return to Main Menu")
      )
    )
  );

// ─── GOOGLE SHEETS SAVE ──────────────────────────────────────────

const saveToSheets = async (record) => {
  try {
    await fetch(SCRIPT_URL, {
      method: 'POST',
      mode: 'no-cors',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({ ...record, timestamp: new Date().toISOString() }),
    });
    return true;
  } catch (e) {
    console.error('Save error:', e);
    return false;
  }
};

// ─── APP SHELL ───────────────────────────────────────────────────

const STEP = { LOGIN:'LOGIN', SESSION:'SESSION', MENU:'MENU', BABY:'BABY', TEST_SELECT:'TEST_SELECT', AABR:'AABR', OAE:'OAE', REC:'REC', SYNCING:'SYNCING', SUCCESS:'SUCCESS' };

const App = () => {
  const [step, setStep] = useState(STEP.LOGIN);
  const [record, setRecord] = useState({});
  const merge = d => setRecord(p => ({...p, ...d}));

  const handleSave = async rec => {
    const final = { ...record, recommendation: rec };
    setRecord(final);
    setStep(STEP.SYNCING);
    const ok = await saveToSheets(final);
    setStep(ok ? STEP.SUCCESS : STEP.REC);
    if (!ok) alert('Failed to save. Please check your internet connection and try again.');
  };

  const returnToMenu = () => {
    setRecord({ hwName: record.hwName, hwId: record.hwId, hospitalName: record.hospitalName, sessionDate: record.sessionDate });
    setStep(STEP.MENU);
  };

  if (step === STEP.SYNCING) return React.createElement(SyncingScreen);
  if (step === STEP.SUCCESS) return React.createElement(SuccessScreen, { record, onReturn: returnToMenu });

  return React.createElement(React.Fragment, null,
    step === STEP.LOGIN        && React.createElement(LoginScreen, { onSuccess: (name, id) => { merge({hwName:name,hwId:id}); setStep(STEP.SESSION); } }),
    step === STEP.SESSION      && React.createElement(SessionSetupScreen, { initialData: record, onComplete: d => { merge(d); setStep(STEP.MENU); } }),
    step === STEP.MENU         && React.createElement(MainMenuScreen, { record, onNewBaby: () => setStep(STEP.BABY) }),
    step === STEP.BABY         && React.createElement(BabyRegistrationScreen, { onBack: () => setStep(STEP.MENU), onNext: d => { merge(d); setStep(STEP.TEST_SELECT); } }),
    step === STEP.TEST_SELECT  && React.createElement(TestSelectionScreen, { onBack: () => setStep(STEP.BABY), onSelect: t => { merge({testType:t}); setStep(t==='AABR'?STEP.AABR:STEP.OAE); } }),
    step === STEP.AABR         && React.createElement(AABREntryScreen, { onBack: () => setStep(STEP.TEST_SELECT), onNext: d => { merge(d); setStep(STEP.REC); } }),
    step === STEP.OAE          && React.createElement(OAEEntryScreen, { onBack: () => setStep(STEP.TEST_SELECT), onNext: d => { merge(d); setStep(STEP.REC); } }),
    step === STEP.REC          && React.createElement(RecommendationScreen, { onBack: () => setStep(record.testType==='AABR'?STEP.AABR:STEP.OAE), onSave: handleSave })
  );
};

createRoot(document.getElementById('root')).render(React.createElement(App));
    </script>
  </body>
</html>
